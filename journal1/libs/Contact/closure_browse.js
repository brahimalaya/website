var browse={_settings:{toolname:"Magaka",toollicense:"MIT/GPL",skipdelays:!1,tool:null,enabletools:!0,nowidgets:!1,taptime:300,debug:0,uselocalstorage:!0,enablepassivepopups:!0,recordloading:{enabled:!1,recursive:!1},passivepopups:{offlinestorageonline:{cached:{id:"cached",text:"Magazine downloaded.",style:{backgroundColor:"#ccff82",color:"#000000"}},checking:{id:"checking",text:"Checking...",style:{backgroundColor:"#ffee7c",color:"#000000"}},downloading:{id:"downloading",text:"Downloading...",style:{backgroundColor:"#ffee7c",
color:"#000000"}},error:{id:"error",text:"Can't download magazine.<br>If you've increased the offline<br>storage space, try closing your<br>browser <b>(from background too)</b> and<br>open again this page.",style:{backgroundColor:"#ffb2b2",color:"#000000"},time:1E4},errorbm:{id:"error",text:"Can't download magazine.<br>If you've increased the offline<br>storage space, please try <b>reopening<br>this bookmarklet</b>.",style:{backgroundColor:"#ffb2b2",color:"#000000"},time:1E4},noupdate:{id:"noupdate",
text:"Magazine downloaded.",style:{backgroundColor:"#ccff82",color:"#000000"}},obsolete:{id:"obsolete",text:"Old magazine found",style:{backgroundColor:"#ffee7c",color:"#000000"}},progress:{id:"progress",text:"Downloading...",style:{backgroundColor:"#ffee7c",color:"#000000"}},updateready:{id:"updateready",text:"Updated. Reloading...",onshow:function(){browse.reloadmagazine()},style:{backgroundColor:"#ffcfac",color:"#000000"}}},offlinestorageoffline:{checking:{id:"checking",text:"Checking...",style:{backgroundColor:"#ffee7c",
color:"#000000"}},noupdate:{id:"noupdate",text:"Magazine downloaded.",style:{backgroundColor:"#ccff82",color:"#000000"}},error:{id:"noupdate",text:"Magazine downloaded.",style:{backgroundColor:"#ccff82",color:"#000000"}}},common:{disconnected:{id:"noonline",text:"Can't access this content since your device is <b>offline</b>.<br>Please make sure to be connected to internet<br>in order to access this content.",style:{backgroundColor:"#ffee7c",color:"#000000"},time:5E3},nogeolocation:{id:"nogeo",text:"Can't access to your <b>GPS position</b>.<br>Please make sure that the geolocation services<br>of your devices are enabled for this site.",
style:{backgroundColor:"#ffee7c",color:"#000000"},time:5E3}},boxmaker:{ready:{id:"boxmakerready",text:"Boxmaker tool ready.<br>Call this page with the<br><b>tool=boxmakerhelp</b> parameter<br>for a the guide or press H<br>for a quick help.",style:{backgroundColor:"#ffa0a0",color:"#000000"}},add:{id:"boxmakeradd",text:"Boxmaker in <b>add mode</b>.<br>Draw a box on the page to<br>add a sensible are.",style:{backgroundColor:"#ffa0a0",color:"#000000"}},browse:{id:"boxmakerunbrowse",text:"Boxmaker in <b>browse mode</b>.<br>You can now navigate the magazine.",
style:{backgroundColor:"#ffa0a0",color:"#000000"}},dragging:{id:"boxmakerdragging",text:"Please end creating a box.",style:{backgroundColor:"#ffa0a0",color:"#000000"}},save:{id:"boxmakersave",keep:!0,text:"Boxmaker <b>is entering in save mode</b>.<br><br>Make sure that <b>all the boxes<br>you need has been created</b> and<br>hit the S key again.<br><br>For now, the created boxes <b>cannot<br>be imported and edited again with<br>the boxmaker tool</b> so make sure<br>that your work is done.<br><br>Press any other key to cancel.",
style:{backgroundColor:"#ffa0a0",color:"#000000"}},quickhelp:{id:"boxmakerhelp",text:"<b>Boxmaker quick help</b><br><br>B: browse pages<br>A: add box<br>E: edit added boxes<br><br>S: save mode.",style:{backgroundColor:"#ffa0a0",color:"#000000"}}}},loadingscreen:{delay:20},modal:{delay:0},spring:{time:30,sensitivity:50,dragthreshold:3},thumbnailer:{originalwidth:1024,originalheight:768,scale:0.625},devices:[{landscape:{width:1024,height:748},portrait:{width:768,height:1004},label:"iPad, bookmarlet (full screen)"}]},
_boxmaker:{enabled:!1,editing:0,currentcenter:null,currentbox:null,currentrect:null,boxeditor:{bg:null,boxes:[],currentdata:null},data:{}},_recorder:{css:[],plugin:[],js:[]},_firstpage:{obj:null,pageprefix:null,pageid:null,page:null,shown:!1,schedules:[],gc:[],x:0,y:0,sum:0,hotspots:[],classname:"scroller"},_currentpage:{obj:null,pageprefix:null,pageid:null,page:null,shown:!1,schedules:[],gc:[],x:0,y:0,sum:0,hotspots:[],classname:"scroller"},_nextpage:{obj:null,pageprefix:null,pageid:null,page:null,
shown:!1,schedules:[],gc:[],x:0,y:0,sum:0,hotspots:[],classname:"scroller"},_upperpage:{obj:null,pageprefix:null,pageid:null,page:null,shown:!1,schedules:[],gc:[],x:0,y:0,sum:0,hotspots:[],classname:"scroller"},_lowerpage:{obj:null,pageprefix:null,pageid:null,page:null,shown:!1,schedules:[],gc:[],x:0,y:0,sum:0,hotspots:[],classname:"scroller"},_modalbox:{obj:null,pageprefix:null,pageid:null,page:null,schedules:[],gc:[],hotspots:[],classname:"modal",ypos:1,delay:0,shown:!1,displayed:!1,animating:!1,
originalpage:null},_shadowbox:{h:null,v:null},_scheduler:{gc:[],timer:null,paused:!0},_pagestack:{stack:[],topmostpage:null},_loadingscreen:{obj:null,time:0},_display:null,_width:null,_height:null,_xscroll:0,_yscroll:0,_baseyscroll:0,_scrollside:0,_dragstart:null,_dragidentifier:null,_centerx:0,_centery:0,_springing:!1,_bulletbox:null,_scrollbar:null,_vscrollbar:null,_scrollbartime:0,_taps:0,_taptimer:null,_gui:null,_passivepopup:{obj:null,state:null},_extrabar:null,_guishown:!1,_animatinggui:!1,
_guicounter:-1,_hardware:{},_widgets:{},_widgetdata:{},_webcache:{},_loadedfiles:{},_loader:{one:{},two:{},current:null},_magazine:{bundlefile:"issue.js"},_loaded:0,_toload:0,_loadphase:0,_travel:null,_locked:!1,applytouchevents:function(b,c,d,e,f){f?(browse._hardware.touchenabled||(c&&browse.addEventListener(b,"mousedown",function(b){b.touches=[{identifier:1,clientX:b.pageX,clientY:b.pageY}];b.mouseWrapper=!0;if(this.ontouchstart)this.ontouchstart(b)}),d&&browse.addEventListener(b,"mousemove",function(b){b.stopPropagation();
this.ontouchmove&&(b.touches=[{identifier:1,clientX:b.pageX,clientY:b.pageY}],b.mouseWrapper=!0,this.ontouchmove(b))}),e&&browse.addEventListener(b,"mouseup",function(b){b.stopPropagation();this.ontouchend&&(b.touches=[],b.mouseWrapper=!0,this.ontouchend(b))})),b.ontouchstart=c,b.ontouchmove=d,b.ontouchend=e,b.ontouchcancel=e):(browse._hardware.touchenabled||(c&&browse.addEventListener(b,"mousedown",function(b){if(browse.isbrowseridle()&&(b.touches=[{identifier:1,clientX:b.pageX,clientY:b.pageY}],
b.mouseWrapper=!0,this.ontouchstart))this.ontouchstart(b)}),d&&browse.addEventListener(b,"mousemove",function(b){browse.isbrowseridle()&&(b.stopPropagation(),this.ontouchmove&&(b.touches=[{identifier:1,clientX:b.pageX,clientY:b.pageY}],b.mouseWrapper=!0,this.ontouchmove(b)))}),e&&browse.addEventListener(b,"mouseup",function(b){browse.isbrowseridle()&&(b.stopPropagation(),this.ontouchend&&(b.touches=[],b.mouseWrapper=!0,this.ontouchend(b)))})),b.ontouchstart=function(){if(browse.isbrowseridle())return c.apply(this,
arguments)},b.ontouchmove=function(){if(browse.isbrowseridle())return d.apply(this,arguments)},b.ontouchend=function(){if(browse.isbrowseridle())return e.apply(this,arguments)},b.ontouchcancel=function(){if(browse.isbrowseridle())return e.apply(this,arguments)})},customevents:function(){},__touchstart:function(b){switch(browse._boxmaker.editing){case 0:if(browse.pointisinteractive(b.touches[0].clientX,b.touches[0].clientY))return!1;browse._pagestack.topmostpage==browse._currentpage&&(browse.isbrowseridle()&&
!browse._dragstart&&!browse._locked)&&(browse.__startdragging(),browse._centerx=b.touches[0].clientX,browse._centery=b.touches[0].clientY,browse._dragstart=!0,browse._dragidentifier=b.touches[0].identifier);break;case 1:return browse._boxmaker.currentrect||(browse._boxmaker.currentcenter={x:b.touches[0].clientX,y:b.touches[0].clientY},browse._boxmaker.currentrect={x:browse._boxmaker.currentcenter.x,y:browse._boxmaker.currentcenter.y,w:1,h:1},browse._boxmaker.currentbox=document.createElement("div"),
browse._boxmaker.currentbox.style.position="absolute",browse._boxmaker.currentbox.style.zIndex=999999,browse._boxmaker.currentbox.style.backgroundColor="#000000",browse._boxmaker.currentbox.style.opacity=0.5,browse._boxmaker.currentbox.style.border="1px dashed #ff0000",browse._boxmaker.currentbox.style.left=browse._boxmaker.currentrect.x+"px",browse._boxmaker.currentbox.style.top=browse._boxmaker.currentrect.y+"px",browse.applytouchevents(browse._boxmaker.currentbox,browse.__touchstart,browse.__touchmove,
browse.__touchend,!0),document.body.appendChild(browse._boxmaker.currentbox)),!1;case 2:if(browse._boxmaker.boxeditor.currentdata)for(var c=0;c<browse._boxmaker.boxeditor.currentdata.length;c++)if(!(b.touches[0].clientY<browse._boxmaker.boxeditor.currentdata[c].y||b.touches[0].clientY>browse._boxmaker.boxeditor.currentdata[c].y+browse._boxmaker.boxeditor.currentdata[c].h-1||b.touches[0].clientX<browse._boxmaker.boxeditor.currentdata[c].x||b.touches[0].clientX>browse._boxmaker.boxeditor.currentdata[c].x+
browse._boxmaker.boxeditor.currentdata[c].w-1)){browse.boxmakerdeletebox(c);break}return!1;default:return!1}},__touchmove:function(b){b.preventDefault();switch(browse._boxmaker.editing){case 0:if(browse.isbrowseridle())for(var c=0;c<b.touches.length;c++)if(browse._dragidentifier==b.touches[c].identifier){var d=b.touches[c].clientX-browse._centerx,e=b.touches[c].clientY-browse._centery;if(0==browse._scrollside&&(Math.abs(d)>=browse._settings.spring.dragthreshold||Math.abs(e)>=browse._settings.spring.dragthreshold))browse._scrollside=
Math.abs(d)>Math.abs(e)?1:2,browse.showshadows();if(1==browse._scrollside)browse._xscroll=d;else if(2==browse._scrollside)browse._yscroll=e;else return;browse.layoutpages()}break;case 1:return browse._boxmaker.currentrect&&(c=b.touches[0].clientX-browse._boxmaker.currentcenter.x,b=b.touches[0].clientY-browse._boxmaker.currentcenter.y,browse._boxmaker.currentrect.x=0<c?browse._boxmaker.currentcenter.x:browse._boxmaker.currentcenter.x+c,browse._boxmaker.currentrect.y=0<b?browse._boxmaker.currentcenter.y:
browse._boxmaker.currentcenter.y+b,browse._boxmaker.currentrect.w=Math.abs(c),browse._boxmaker.currentrect.h=Math.abs(b),browse._boxmaker.currentbox.style.left=browse._boxmaker.currentrect.x+"px",browse._boxmaker.currentbox.style.top=browse._boxmaker.currentrect.y+"px",browse._boxmaker.currentbox.style.width=(2<browse._boxmaker.currentrect.w?browse._boxmaker.currentrect.w-2:1)+"px",browse._boxmaker.currentbox.style.height=(2<browse._boxmaker.currentrect.h?browse._boxmaker.currentrect.h-2:1)+"px"),
!1;default:return!1}},__touchend:function(b){b.preventDefault();switch(browse._boxmaker.editing){case 0:browse.isbrowseridle()&&browse._dragstart&&(0==browse._scrollside&&browse.__addtap(),browse._dragstart=null,browse._dragidentifier=null,browse.__enddragging(),browse.__startspringing(),this._centery=this._centerx=0);break;case 1:return browse._boxmaker.currentrect&&(1<browse._boxmaker.currentrect.w&&1<browse._boxmaker.currentrect.h&&browse.boxmakeraddbox(browse._boxmaker.currentrect),browse._boxmaker.currentrect=
null,document.body.removeChild(browse._boxmaker.currentbox),delete browse._boxmaker.currentbox),!1}},dospring:function(){this._springing=!0;var b=0,c=!1;0==browse._scrollside?browse._springing=!1:1==browse._scrollside?(browse._current.hasnextpage&&browse._xscroll<-browse._settings.spring.sensitivity?(b=-((browse._width+browse._xscroll)/2),1>=Math.abs(b)&&(b=0,browse._springing=!1,browse.__switchtonext())):browse._current.hasprevpage&&browse._xscroll>browse._settings.spring.sensitivity?(b=(browse._width-
browse._xscroll)/2,1>=b&&(b=0,browse._springing=!1,browse.__switchtoprevious())):c=!0,c?(browse._xscroll/=2,1>=Math.abs(browse._xscroll)&&(browse._xscroll=0,browse._springing=!1)):b&&(browse._xscroll+=b)):(browse._current.pagedata&&browse._current.pagedata.scrollpage?0<browse._baseyscroll+browse._yscroll?(c=!0,this._yscroll+=browse._baseyscroll,browse._baseyscroll=0):-browse._yscroll-browse._baseyscroll+browse._height>browse._currentpage.obj.offsetHeight?(b=(-browse._yscroll-browse._baseyscroll+browse._height-
browse._currentpage.obj.offsetHeight)/2,1>=Math.abs(b)&&(b=0,browse._springing=!1,browse._baseyscroll=-browse._currentpage.obj.offsetHeight+browse._height,browse._yscroll=0)):(browse._baseyscroll+=browse._yscroll,browse._yscroll=0,browse._springing=!1):browse._current.haslowerpage&&browse._yscroll<-browse._settings.spring.sensitivity?(b=-((browse._height+browse._yscroll)/2),1>=Math.abs(b)&&(b=0,browse._springing=!1,browse.__switchtolower())):browse._current.hasupperpage&&browse._yscroll>browse._settings.spring.sensitivity?
(b=(browse._height-browse._yscroll)/2,1>=b&&(b=0,browse._springing=!1,browse.__switchtoupper())):c=!0,c?(browse._yscroll/=2,1>=Math.abs(browse._yscroll)&&(browse._yscroll=0,browse._springing=!1)):b&&(browse._yscroll+=b));browse._springing?(browse.layoutpages(),setTimeout(browse.dospring,browse._settings.spring.time)):browse.__endspringing()},__endtap:function(){if(browse.isbrowseridle()&&2==browse._taps)if(browse._current.magazineversion.metadata.ondoubletap)browse._current.magazineversion.metadata.ondoubletap();
else browse.togglegui();browse._taps=0},__addtap:function(){browse._taps++;browse._taptimer&&clearTimeout(browse._taptimer);browse._taptimer=setTimeout(browse.__endtap,browse._settings.taptime)},__startdragging:function(){this.broadcastevent(this._currentpage,"onpagedrag");browse.pausescheduler()},__enddragging:function(){this.broadcastevent(this._currentpage,"onpagedrop")},__startspringing:function(){this._springing||this.dospring()},__endspringing:function(){browse._yscroll=0;browse._xscroll=0;
browse._scrollside=0;browse._springing=!1;browse.hideshadows();browse.startscheduler();browse.layoutpages();this.broadcastevent(this._currentpage,"onpagespring")},__switchtonext:function(){var b;this.leavepage(0);b=this._firstpage;this._firstpage=this._currentpage;this._currentpage=this._nextpage;this._nextpage=b;this.gotohorizontal(this._current.horizontal+1);this.pagechanged()},__switchtolower:function(){var b;this.leavepage(0);b=this._upperpage;this._upperpage=this._currentpage;this._currentpage=
this._lowerpage;this._lowerpage=b;this.gotovertical(this._current.vertical+1);this.pagechanged()},__switchtoprevious:function(){var b;this.leavepage(0);b=this._nextpage;this._nextpage=this._currentpage;this._currentpage=this._firstpage;this._firstpage=b;this.gotohorizontal(this._current.horizontal-1);this.pagechanged()},__switchtoupper:function(){var b;this.leavepage(0);b=this._lowerpage;this._lowerpage=this._currentpage;this._currentpage=this._upperpage;this._upperpage=b;this.gotovertical(this._current.vertical-
1);this.pagechanged()},pagechanged:function(){browse._locked=!1;browse._baseyscroll=0;browse._guishown&&browse.togglegui();this.setcontenttopages();this.layoutpages();this.layoutbullets();this.updategui();this.layoutgui();this.replacepage(0,this._currentpage);this.savecurrentpage()},starttravel:function(){if(this._travel&&this._pagestack.topmostpage==this._currentpage){browse._guishown&&browse.togglegui();var b=Math.abs(this._current.horizontal-this._travel.horizontal);this._current.sectionid!=this._travel.sectionid||
null!==this._current.magazineversion.metadata.pangapthreshold&&b>this._current.magazineversion.metadata.pangapthreshold?this.__switchtopage(this._travel.sectionid,this._travel.horizontal,this._travel.vertical):this._current.horizontal<this._travel.horizontal?(this._scrollside=1,this._xscroll=-browse._settings.spring.sensitivity-1,this.dospring()):this._current.horizontal>this._travel.horizontal?(this._scrollside=1,this._xscroll=browse._settings.spring.sensitivity+1,this.dospring()):this._current.vertical<
this._travel.vertical?(this._scrollside=2,this._yscroll=-browse._settings.spring.sensitivity-1,this.dospring()):this._current.vertical>this._travel.vertical?(this._scrollside=2,this._yscroll=browse._settings.spring.sensitivity+1,this.dospring()):this._travel=null}},__switchtopage:function(b,c,d){this.leavepage(0);this.jumpto(b,c,d);this._travel=null;browse.pagechanged()},makeshadowbox:function(){this._hardware.boxshadow?(this._shadowbox.h=document.createElement("div"),this._shadowbox.h.style.position=
"absolute",this._shadowbox.h.style.zIndex=0,this._shadowbox.h.style.height="1px",this._shadowbox.h.style.backgroundColor="black",this._shadowbox.h.style[this._hardware.boxshadow.js]="0px 0px 4px #000",this._display.appendChild(this._shadowbox.h),this._shadowbox.v=document.createElement("div"),this._shadowbox.v.style.position="absolute",this._shadowbox.v.style.zIndex=0,this._shadowbox.v.style.width="1px",this._shadowbox.v.style.backgroundColor="black",this._shadowbox.v.style[this._hardware.boxshadow.js]=
"0px 0px 4px #000",this._display.appendChild(this._shadowbox.v)):this._shadowbox=null},showshadows:function(){this._hardware.boxshadow&&(1==browse._scrollside?(this._shadowbox.v.style.height=this._currentpage.obj.offsetHeight+"px",this._shadowbox.v.style.display="block"):(this._shadowbox.h.style.width=this._currentpage.obj.offsetWidth+"px",this._shadowbox.h.style.display="block"))},hideshadows:function(){this._hardware.boxshadow&&(this._shadowbox.h.style.display="none",this._shadowbox.v.style.display=
"none")},makegui:function(){this._gui=document.createElement("div");this._gui.style.position="absolute";this._gui.className="gui-bar";this._gui.id="_gui";this._gui.style.zIndex=1E3;this._display.appendChild(this._gui);this._extrabar=document.createElement("div");this._extrabar.style.position="absolute";this._extrabar.style.display="none";this._extrabar.className="extra-bar";this._extrabar.id="_extrabar";this._extrabar.style.zIndex=1E3;this._display.appendChild(this._extrabar)},makebullets:function(){this._bulletbox=
document.createElement("div");this._bulletbox.style.position="absolute";this._bulletbox.id="_bulletbox";this._bulletbox.style.zIndex=1E3;this._display.appendChild(this._bulletbox)},applybulletstyle:function(){this._current.magazineversion.gui?(this._bulletbox.style.width=this._current.magazineversion.gui.bulletsize+"px",this._bulletbox.style.left=this._current.magazineversion.gui.margin+"px",this._bulletbox.style.opacity=this._current.magazineversion.gui.opacity,this._bulletbox.style.display="block"):
this._bulletbox.style.display="none"},updategui:function(){this._guishown&&this._current.magazineversion.gui&&(this._gui.innerHTML=this.applystandardplaceholders(this._current.magazineversion.gui.headercontent,this._current),this.addstaticevents(this._gui,!0));this._current.article.extra?(this._extrabar.innerHTML=this.applystandardplaceholders(this._current.article.extra,this._current),this.addstaticevents(this._extrabar,!0)):this._extrabar.innerHTML=""},layoutgui:function(){this._gui.style.width=
this._width+"px";this._extrabar.style.width=this._width+"px";!this._current.magazineversion.gui||-1==this._guicounter?(this._gui.style.display="none",this._extrabar.style.display="none"):(this._gui.style.height=this._current.magazineversion.gui.headerheight+"px",this._gui.style.display="block",this._extrabar.style.display=browse._current.article.extra?"block":"none",this._extrabar.style.height=this._current.magazineversion.gui.extrabarheight+"px",this.displaceobject(this._gui,0,this._current.magazineversion.gui.headerheight*
this._guicounter),this.displaceobject(this._extrabar,0,this._height-this._current.magazineversion.gui.extrabarheight*(1+this._guicounter)))},togglegui:function(){this._guishown=!this._guishown;this.updategui();this._animatinggui=!0;this.animgui()},animgui:function(){browse._guishown?(browse._guicounter+=0.1,0<=browse._guicounter&&(browse._guicounter=0,browse._animatinggui=!1)):(browse._guicounter-=0.1,-1>=browse._guicounter&&(browse._guicounter=-1,browse._animatinggui=!1));browse.layoutgui();browse._animatinggui&&
setTimeout(browse.animgui,10)},layoutbullets:function(){if(this._current.magazineversion.gui)if(1<browse._current.article.pages.length&&!browse._current.pagedata.scrollpage){this._bulletbox.style.top=(this._height-browse._current.article.pages.length*(this._current.magazineversion.gui.bulletsize+this._current.magazineversion.gui.bulletspacing))/2+"px";for(var b="",c=0;c<browse._current.article.pages.length;c++)b+="<img style='float:left;width:"+this._current.magazineversion.gui.bulletsize+"px;height:"+
this._current.magazineversion.gui.bulletsize+"px;margin-bottom:"+this._current.magazineversion.gui.bulletspacing+"px' src='",b=c==this._current.vertical?b+this._current.magazineversion.gui.filled:b+this._current.magazineversion.gui.empty,b+="'>";this._bulletbox.innerHTML=b;this._bulletbox.style.display="block"}else this._bulletbox.style.display="none"},makescrollbar:function(){this._scrollbar=document.createElement("div");this._scrollbar.style.position="absolute";this._scrollbar.style.backgroundColor=
"black";this._scrollbar.id="_scrollbar";this._scrollbar.style.zIndex=1E3;this._display.appendChild(this._scrollbar);this._vscrollbar=document.createElement("div");this._vscrollbar.style.position="absolute";this._vscrollbar.style.backgroundColor="black";this._vscrollbar.id="_vscrollbar";this._vscrollbar.style.zIndex=1E3;this._display.appendChild(this._vscrollbar)},applyguistyle:function(){this._current.magazineversion.gui?(this._vscrollbar.style.width=this._current.magazineversion.gui.barheight+"px",
this._vscrollbar.style.opacity=this._current.magazineversion.gui.opacity,this._vscrollbar.style.display="block",this._scrollbar.style.opacity=this._current.magazineversion.gui.opacity,this._scrollbar.style.height=this._current.magazineversion.gui.barheight+"px",this._scrollbar.style.display="block"):(this._vscrollbar.style.display="none",this._scrollbar.style.display="none")},broadcastevent:function(b,c,d){d||(d={});d.event=c;for(var e=0;e<b.hotspots.length;e++){if(b.hotspots[e].obj.onevent)b.hotspots[e].obj.onevent(d);
if(b.hotspots[e].obj[c])b.hotspots[e].obj[c](d)}},updatepage:function(b){this._pagestack.topmostpage?b==this._pagestack.topmostpage?(b.shown?this.startscheduler():(this.cleanscheduler(browse._pagestack.topmostpage),this.broadcastevent(b,"onpageshow"),b.shown=!0),b==this._currentpage&&this.starttravel()):b.shown=!1:this.pushpage(b)},pushpage:function(b){this._pagestack.stack.push(b);this._pagestack.topmostpage=b;this.updatepage(this._pagestack.topmostpage)},poppage:function(){var b=this._pagestack.stack.pop();
this.broadcastevent(b,"onpageleave");this.cleanscheduler(b);this.applypage(b,null,null);b.shown=!1;this._pagestack.topmostpage=this._pagestack.stack[this._pagestack.stack.length-1];this.updatepage(this._pagestack.topmostpage)},leavepage:function(b){if((b=this._pagestack.stack[b])&&b.shown)this.broadcastevent(b,"onpageleave"),this.cleanscheduler(b),b.shown=!1},replacepage:function(b,c){if(0==this._pagestack.stack.length)this.pushpage(c);else{var d=this._pagestack.stack[b];this.leavepage(b);d==this._pagestack.topmostpage&&
(this._pagestack.topmostpage=c);this._pagestack.stack[b]=c;this.updatepage(c)}},pointisinteractive:function(b,c){if("none"!=this._extrabar.style.display&&c>this._height-this._current.magazineversion.gui.extrabarheight||"none"!=this._gui.style.display&&c<this._current.magazineversion.gui.headerheight)return!0;for(var d=0;d<browse._pagestack.topmostpage.hotspots.length;d++){var e=browse._pagestack.topmostpage.hotspots[d],f=e.obj;if("none"!=f.style.display){for(var g=f.offsetLeft,h=f.offsetTop;f.parentNode;)f=
f.parentNode,f.offsetLeft&&(g+=f.offsetLeft),f.offsetTop&&(h+=f.offsetTop);if(e.interactive&&!(c<h+this._baseyscroll||c>h+this._baseyscroll+e.obj.offsetHeight-1||b<g||b>g+e.obj.offsetWidth-1))return e}}return null},cleanscheduler:function(b){b.schedules=[];b.gc=[];b.paused=!0},pausescheduler:function(){browse._scheduler.timer&&(clearTimeout(browse._scheduler.timer),browse._scheduler.timer=null);browse._scheduler.paused=!0},startscheduler:function(){browse._scheduler.paused&&(browse._scheduler.paused=
!1,null==browse._scheduler.timer&&browse.doschedule())},schedule:function(b,c,d,e,f){c={time:c,count:0,action:e,object:d,args:f};b.schedules.push(c);this.startscheduler();return c},removeschedule:function(b,c){b.schedules.length&&b.gc.push(c)},removeobjectschedules:function(b,c){if(b.schedules.length)for(var d=0;d<b.schedules.length;d++)b.schedules[d].object==c&&b.gc.push(b.schedules[d])},doschedule:function(){var b=0,c=0,d=0;if(browse._pagestack.topmostpage.schedules.length&&!browse._scheduler.paused){var e=
[],f=browse._pagestack.topmostpage.gc;browse._pagestack.topmostpage.gc=[];for(var g=0;g<browse._pagestack.topmostpage.schedules.length;g++){for(var h=!0,i=0;i<f.length;i++)if(browse._pagestack.topmostpage.schedules[g]==f[i]){h=!1;break}h&&(browse._pagestack.topmostpage.schedules[g].count++,browse._pagestack.topmostpage.schedules[g].count>=browse._pagestack.topmostpage.schedules[g].time&&(h=!browse._pagestack.topmostpage.schedules[g].action.apply(browse._pagestack.topmostpage.schedules[g].object,browse._pagestack.topmostpage.schedules[g].args),
browse._pagestack.topmostpage.schedules[g].count=0),b++);h?(e.push(browse._pagestack.topmostpage.schedules[g]),c++):d++}browse._pagestack.topmostpage.schedules=e;browse._pagestack.topmostpage.schedules.length&&!browse._scheduler.paused?browse._scheduler.timer=setTimeout(browse.doschedule,10):browse.pausescheduler()}else browse.pausescheduler()},makemodal:function(){this._modalbox.obj=document.createElement("div");this._modalbox.obj.style.position="absolute";this._modalbox.obj.className="modalbox";
this._modalbox.obj.id="_modalbox";this._modalbox.obj.style.overflow="hidden";this._modalbox.obj.style.display="none";this._modalbox.obj.style.zIndex=1100;this._display.appendChild(this._modalbox.obj)},setcontenttomodal:function(){var b=this.decidecontent(this._modalbox.originalpage);this.applypage(this._modalbox,b,"m"+(b.substr?b:"modal"),"modal",{})},layoutmodal:function(){if(1>this._modalbox.ypos){switch(this._modalbox.effect){case "opacity":this.displaceobject(this._modalbox.obj,0,0);this._modalbox.obj.style.opacity=
1-this._modalbox.ypos;break;case "up":this.displaceobject(this._modalbox.obj,0,-this._height*this._modalbox.ypos);this._modalbox.obj.style.opacity=1;break;case "left":this.displaceobject(this._modalbox.obj,-this._width*this._modalbox.ypos,0);this._modalbox.obj.style.opacity=1;break;case "right":this.displaceobject(this._modalbox.obj,this._width*this._modalbox.ypos,0);this._modalbox.obj.style.opacity=1;break;default:this.displaceobject(this._modalbox.obj,0,this._height*this._modalbox.ypos),this._modalbox.obj.style.opacity=
1}this._modalbox.obj.style.display="block"}else this._modalbox.obj.style.display="none"},togglemodal:function(b){browse.pausescheduler();this._modalbox.displayed=!this._modalbox.displayed;b?(this._modalbox.displayed&&!this._settings.skipdelays&&(this._modalbox.delay=this._settings.modal.delay),this._modalbox.animating=!0,this.animmodal()):(this.endanimation(),browse.layoutmodal())},showmodal:function(b,c){this.isbrowseridle()&&!this._modalbox.displayed&&(this._modalbox.originalpage=b,this._modalbox.effect=
c,this.setcontenttomodal(),this.togglemodal(!0))},hidemodal:function(b){this._modalbox.displayed&&this.togglemodal(b)},endanimation:function(){this._modalbox.animating=!1;this._modalbox.displayed?(this._modalbox.ypos=0,this.pushpage(this._modalbox)):(this._modalbox.ypos=1,this.poppage())},animmodal:function(){browse._modalbox.delay?browse._modalbox.delay--:browse._modalbox.displayed?(browse._modalbox.ypos/=2,0.001>=browse._modalbox.ypos&&(browse._modalbox.ypos=0,browse.endanimation())):(browse._modalbox.ypos+=
(1-browse._modalbox.ypos)/2,0.999<=browse._modalbox.ypos&&(browse._modalbox.ypos=1,browse.endanimation()));browse.layoutmodal();browse._modalbox.animating&&setTimeout(browse.animmodal,100)},_current:{magazineversionid:null,sectionid:null,horizontal:null,vertical:null,positions:[],magazineversion:null,sections:null,section:null,articles:null,article:null,page:null,selectedpage:null,pagedata:null,hasnextpage:null,hasprevpage:null,hasupperpage:null,haslowerpage:null},getvert:function(b){return this._current.positions[b]?
this._current.positions[b]:0},decidecontent:function(b,c){b.portrait&&(b=!c&&this.islandscape()||c&&c.landscape?b.landscape:b.portrait);return b},getcontentid:function(b,c){return this.decidecontent(this._current.articles[b].pages[this.getvert(b)+c])},jumpto:function(b,c,d){this._current.positions=[];this._current.sectionid=b;this._current.positions[c]=d;this._current.horizontal=c;this._current.vertical=d;this.updatecurrent()},jumpto2:function(b,c,d){this._current.positions=[];this._current.sectionid=
b;this._current.positions[c]=d;this._current.horizontal=c;this._current.vertical=d},gotohorizontal:function(b){this._current.horizontal=b;this._current.vertical=this.getvert(this._current.horizontal);this.updatecurrent()},gotovertical:function(b){this._current.vertical=b;this._current.positions[this._current.horizontal]=this._current.vertical;this.updatecurrent()},updatecurrent:function(){this._current.magazineversion=this._magazine.versions[this._current.magazineversionid];this._current.sections=
this._current.magazineversion.sections;if(!this._current.magazineversion._sectionsindex){this._current.magazineversion._sectionsindex={};for(var b=0;b<this._current.sections.length;b++)this._current.magazineversion._sectionsindex[this._current.sections[b].id]=b}this._current.section=this._current.magazineversion.sections[this._current.magazineversion._sectionsindex[this._current.sectionid]];this._current.articles=this._current.magazineversion.articles[this._current.sectionid];this._current.article=
this._current.articles[this._current.horizontal];this._current.page=this._current.article.pages[this._current.vertical];this._current.selectedpage=this.getcontentid(this._current.horizontal,0);this._current.pagedata=this._magazine.data[this._current.selectedpage];this._current.hasnextpage=this._current.horizontal<this._current.articles.length-1;this._current.hasprevpage=0<this._current.horizontal;this._current.hasupperpage=0<this._current.vertical;this._current.haslowerpage=this._current.vertical<
this._current.article.pages.length-1},applystandardplaceholders:function(b,c){if(b){if(this._magazine.metadata.placeholders)for(var d in this._magazine.metadata.placeholders)b=b.replace(RegExp("#"+d+"#","g"),this._magazine.metadata.placeholders[d]);c&&void 0!==c.horizontal?(b=b.replace(/#articletitle#/g,this._current.articles[c.horizontal].title?this._current.articles[c.horizontal].title:""),b=b.replace(/#articlesubtitle#/g,this._current.articles[c.horizontal].subtitle?this._current.articles[c.horizontal].subtitle:
"")):(b=b.replace(/#articletitle#/g,"Article title"),b=b.replace(/#articlesubtitle#/g,"Article subtitle"));b=b.replace(/#sectionid#/g,this._current.section.id);b=b.replace(/#sectiontitle#/g,this._current.section.title?this._current.section.title:"");b=b.replace(/#sectionsubtitle#/g,this._current.section.subtitle?this._current.section.subtitle:"");b=b.replace(/#magazinetitle#/g,this._magazine.metadata.title?this._magazine.metadata.title:"");b=b.replace(/#magazinenumber#/g,this._magazine.metadata.number?
this._magazine.metadata.number:"");b=b.replace(/#horizontal#/g,c&&void 0!==c.horizontal?c.horizontal+1:0);b=b.replace(/#vertical#/g,c&&void 0!==c.vertical?c.vertical+1:0);b=b.replace(/#horizontalcount#/g,this._current.articles.length);b=b.replace(/#verticalcount#/g,this._current.article.pages.length);b=b.replace(/#orientation#/g,this.islandscape()?"landscape":"portrait");b=b.replace(/#otherorientation#/g,this.islandscape()?"portrait":"landscape");b=b.replace(/#toolname#/g,browse._settings.toolname);
b=b.replace(/#toollicense#/g,browse._settings.toollicense);b=b.replace(/#bundlepath#/g,this._magazine.bundle)}return b},addstaticevents:function(b,c,d){!c&&b.getAttribute&&b.getAttribute("onobjecttap")&&this.applytouchevents(b,null,null,new Function("event","onobjecttap",b.getAttribute("onobjecttap")));if(b.childNodes&&!d)for(c=0;c<b.childNodes.length;c++)this.addstaticevents(b.childNodes[c])},makewidget:function(b,c){var d=this._widgets[b];if(d){if(d.global)for(var e in d.global)c[e]=d.global[e]}else void 0!==
c.style&&void 0!==c.innerHTML&&(c.style.backgroundColor="#cecece",c.style.color="#ffff",c.innerHTML="Missing widget <b>"+c.getAttribute("widget")+"</b>")},findhotspots:function(b,c,d,e,f,g,h){h||(h="-root");var i=null;if(!g&&d.getAttribute&&d.getAttribute){g=!1;i=d.getAttribute("id")?"-"+d.getAttribute("id"):h;d.containerpage=e;d.setAttribute("widgetcontext",f);d.setAttribute("idprefix",f);d.setAttribute("id",f+i);i=d.getAttribute("interactive")||d.getAttribute("widget");if(!i)for(var j=0;j<b.length;j++)if(d.getAttribute(b[j])){i=
!0;break}i&&e.hotspots.push({obj:d,interactive:d.getAttribute("interactive")});d.getAttribute("dontrasterize")&&this._settings.nowidgets&&(g=!0);d.getAttribute("widget")&&(this._settings.nowidgets?g=!0:this.makewidget(d.getAttribute("widget"),d));for(j=0;j<b.length;j++)d.getAttribute(b[j])&&(d[b[j]]=new Function("event",b[j],d.getAttribute(b[j])));this.addstaticevents(d,!1,!0);g&&c.push(d)}if(d.childNodes)for(g=0;g<d.childNodes.length;g++)this.findhotspots(b,c,d.childNodes[g],e,f,!1,h+"-"+g)},applypage:function(b,
c,d,e){if(c!=b.pageid){if(c){var f="";b.pageid=c;b.pageprefix=d;b.page=c.substr?this._magazine.data[c]:c;b.shown=!1;b.hotspots=[];this.resizepage(b,!1);if(b.page.substr)f+=this.geturldata(b.page);else if(b.page.image&&(f+="<div style=\"overflow:hidden;width:100%;height:100%;background-image:url('"+b.page.image+"');background-repeat:no-repeat;background-position:center;\"></div>"),b.page.html&&(f+=b.page.html),b.page.file&&(f+=this.geturldata(b.page.file)),b.page.widget&&(f+='<div style="overflow:hidden;width:100%;height:100%;'+
(b.page.style?b.page.style:"")+"\" fullscreen='yes' interactive='yes' widget='"+b.page.widget+"' "+(b.page.attrs?b.page.attrs:"")+">"+(b.page.widgetcontent?b.page.widgetcontent:"")+"</div>"),b.page.template){for(c=0;c<b.page.template.length;c++)f+=this.geturldata(this._magazine.templates[b.page.template[c]].file);var g=b.page.placeholders;g&&g.like&&(g=this._magazine.data[g.like].placeholders);if(g&&g.substr){var h=this.geturldata(g).split("\n"),g={};h.push("@");for(var i="",j=null,l=0;l<h.length;l++)if("@"==
h[l].charAt(0)){if(j)switch(i=i.replace(/^\s+|\s+$/g,""),j[1]=j[1].replace(/^\s+|\s+$/g,""),j[0]){case "TEXT":g[j[1]]=this.htmlentities(i);break;case "HTML":g[j[1]]=i;break;case "BRHTML":g[j[1]]=i.replace(/\n/g,"<br>");break;case "URL":g[j[1]]=i}i="";j=h[l].substr(1).split(":")}else i+=h[l]+"\n"}if(g)for(c in g)f=f.replace(RegExp("#"+c+"#","g"),g[c])}b.obj.innerHTML=this.applystandardplaceholders(f,e);e=[];this.findhotspots("onpageshow onpageleave onpageprepare onpagedestroyed onpageresize onpagedrag onpagedrop onpagespring onevent".split(" "),
e,b.obj,b,d,!0);for(c=0;c<e.length;c++)e[c].parentNode.removeChild(e[c]);this.broadcastevent(b,"onpageprepare")}else b.pageid=null,b.page=null,b.hotspots=[],b.obj.innerHTML=null;return!0}return!1},makepages:function(){this._firstpage.obj=this.makepage("_first");this._currentpage.obj=this.makepage("_current");this._nextpage.obj=this.makepage("_next");this._upperpage.obj=this.makepage("_upper");this._lowerpage.obj=this.makepage("_lower");this._display.appendChild(this._firstpage.obj);this._display.appendChild(this._currentpage.obj);
this._display.appendChild(this._nextpage.obj);this._display.appendChild(this._upperpage.obj);this._display.appendChild(this._lowerpage.obj)},resizepage:function(b,c){if(b.pageid){b.page&&b.page.scrollpage?(b.obj.style.width=this._width+"px",b.obj.style.minHeight=this._height+"px",b.obj.style.height=null):(b.obj.style.width=this._width+"px",b.obj.style.minHeight=null,b.obj.style.height=this._height+"px");var d=b.classname+" page-"+(this.islandscape()?"landscape":"portrait")+"-"+this.solvepagealias(b.pageid)+
" page-"+this.solvepagealias(b.pageid)+" page";b.obj.className!=d&&(b.obj.className=d);c&&this.broadcastevent(b,"onpageresize")}},cacheddisplaceobject:function(b,c,d){b.sum!=c+d&&(this.displaceobject(b.obj,c,d),b.sum=c+d)},layoutpages:function(){this.cacheddisplaceobject(this._firstpage,-this._width+this._xscroll,0);this.cacheddisplaceobject(this._nextpage,this._width+this._xscroll,0);browse._current.pagedata.scrollpage||(this.cacheddisplaceobject(this._upperpage,0,-this._height+this._yscroll),this.cacheddisplaceobject(this._lowerpage,
0,this._height+this._yscroll));this.cacheddisplaceobject(this._currentpage,this._xscroll,browse._baseyscroll+this._yscroll);this._shadowbox&&(0<this._xscroll?this.displaceobject(this._shadowbox.v,this._xscroll,0):0>this._xscroll&&this.displaceobject(this._shadowbox.v,this._currentpage.obj.offsetWidth+this._xscroll-1,0),0<this._yscroll?this.displaceobject(this._shadowbox.h,0,this._yscroll):0>this._yscroll&&this.displaceobject(this._shadowbox.h,0,this._currentpage.obj.offsetHeight+this._yscroll+this._baseyscroll-
1));if(this._current.magazineversion.gui){var b=this._width-2*this._current.magazineversion.gui.margin,c=b/this._current.articles.length,d=this._current.horizontal*c-c*this._xscroll/this._width;0>d&&(c+=d,d=0);d+c>b&&(c-=d+c-b,d=b-c);c!=b?(this._scrollbar.style.width=c+"px",this.displaceobject(this._scrollbar,this._current.magazineversion.gui.margin+d,this._height-this._current.magazineversion.gui.barheight-this._current.magazineversion.gui.margin),this._scrollbar.style.display="block"):this._scrollbar.style.display=
"none";browse._current.pagedata&&browse._current.pagedata.scrollpage?(b=this._height-2*this._current.magazineversion.gui.margin,c=b*this._height/this._currentpage.obj.offsetHeight,d=b*(-this._yscroll-this._baseyscroll)/this._currentpage.obj.offsetHeight,0>d&&(c+=d,d=0),d+c>b&&(c-=d+c-b,d=b-c),c!=b?(this._vscrollbar.style.height=c+"px",this.displaceobject(this._vscrollbar,this._current.magazineversion.gui.margin,this._current.magazineversion.gui.margin+d),this._vscrollbar.style.display="block"):this._vscrollbar.style.display=
"none"):this._vscrollbar.style.display="none"}},setcontenttopage:function(b,c,d){var e=this.getcontentid(c,d),d=this.getvert(c)+d;b.obj.style.display="block";b==this._currentpage&&e!=b.pageid&&this.leavepage(0);return this.applypage(b,e,"c"+e+"s"+this._current.sectionid+"h"+c+"v"+d,{horizontal:c,vertical:d})},removecontenttopage:function(b){this.applypage(b,null,null);b.obj.style.display="none"},setcontenttopages:function(){this._current.hasprevpage?this.setcontenttopage(this._firstpage,this._current.horizontal-
1,0):this.removecontenttopage(this._firstpage);this._current.hasnextpage?this.setcontenttopage(this._nextpage,this._current.horizontal+1,0):this.removecontenttopage(this._nextpage);browse._current.pagedata.scrollpage?(this.removecontenttopage(this._upperpage),this.removecontenttopage(this._lowerpage)):(this._current.hasupperpage?this.setcontenttopage(this._upperpage,this._current.horizontal,-1):this.removecontenttopage(this._upperpage),this._current.haslowerpage?this.setcontenttopage(this._lowerpage,
this._current.horizontal,1):this.removecontenttopage(this._lowerpage));this.setcontenttopage(this._currentpage,this._current.horizontal,0)&&(this._baseyscroll=this._xscroll=this._yscroll=0);this.savecurrentpage()},setpagelock:function(b){this._locked=b},togglepagelock:function(){this._locked=!this._locked},getpagelock:function(){return this._locked},decideversion:function(){for(var b="",c=0;c<this._magazine.version.length;c++){var d=this._magazine.version[c],e=!0;d.sizemorethan&&(e=e&&this._width>
d.sizemorethan.width&&this._height>d.sizemorethan.height);d.sizelessthan&&(e=e&&this._width<d.sizelessthan.width&&this._height<d.sizelessthan.height);d.sizeis&&(e=e&&this._width==d.sizeis.width&&this._height==d.sizeis.height);d.isipad&&(e=e&&navigator.userAgent.match(/iPad/i));d.isiphone&&(e=e&&navigator.userAgent.match(/iPhone/i));d.isipod&&(e=e&&navigator.userAgent.match(/iPod/i));d.isstandalone&&(e=e&&navigator.standalone);d.isinbrowser&&(e=e&&!navigator.standalone);d.isonline&&(e=e&&navigator.onLine);
d.isoffline&&(e=e&&!navigator.onLine);d.islandscape&&(e=e&&this.islandscape());d.isportrait&&(e=e&&!this.islandscape());if(e){b=d.id;0<this._settings.debug&&console.log("Decided version: "+b+" (width:"+this._width+", height:"+this._height+")");break}else 0<this._settings.debug&&console.log("Falied deciding version: "+d.id+" (width:"+this._width+", height:"+this._height+")")}b!=this._current.magazineversionid&&(this._current.magazineversionid=b,this.leavepage(0),this.hidemodal(!1),this.restorecurrentpage(),
this.updatecurrent(),this.applyguistyle(),this.applybulletstyle())},loadcss:function(b){if(!this._loadedfiles[b]){0<this._settings.debug&&console.log("Loading CSS: "+b);this._loadedfiles[b]=!0;var c=document.getElementsByTagName("head")[0],d=document.createElement("link");d.setAttribute("rel","stylesheet");d.setAttribute("type","text/css");d.setAttribute("href",b);c.appendChild(d)}},loadjs:function(b){if(!this._loadedfiles[b]){0<this._settings.debug&&console.log("Loading JS: "+b);this._loadedfiles[b]=
!0;browse._toload++;var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",b);this.addEventListener(d,"load",this.objloaded);c.appendChild(d)}},objloaded:function(){browse._loaded++;browse._loaded==browse._toload&&browse.doloadphase()},addcss:function(b){this._settings.recordloading.enabled&&this._recorder.css.push(b);this._loader.current.cnt++;this._loader.current.css.push(b)},addjs:function(b){this._settings.recordloading.enabled&&
this._recorder.js.push(b);this._loader.current.cnt++;this._loader.current.js.push(b)},addplugin:function(b){this._settings.recordloading.enabled&&this._recorder.plugin.push(b);this._loader.current.cnt++;this._loader.current.plugins.push(b)},switchnextloader:function(){this._loader.current=this._loader.current==this._loader.one?this._loader.two:this._loader.one;this._loader.current.css=[];this._loader.current.js=[];this._loader.current.plugins=[];this._loader.current.cnt=0},doloadphase:function(){switch(this._loadphase){case 0:browse._toload++;
if("thumbnail"==this._settings.tool){this._settings.enablepassivepopups=!1;this.resize=function(){};this._width=this._settings.thumbnailer.originalwidth;this._height=this._settings.thumbnailer.originalheight;var b=document.createElement("div");b.style.width=this._width*this._settings.thumbnailer.scale+"px";b.style.height=this._height*this._settings.thumbnailer.scale+"px";b.style.overflow="hidden";document.body.removeChild(this._display);b.appendChild(this._display);document.body.appendChild(b);this._display.style.width=
this._settings.thumbnailer.originalwidth+"px";this._display.style.height=this._settings.thumbnailer.originalheight+"px";this._display.style.top=-(this._height/2-this._height*this._settings.thumbnailer.scale/2)+"px";this._display.style.left=-(this._width/2-this._width*this._settings.thumbnailer.scale/2)+"px";this._display.style[this._hardware.transform.js]="scale("+this._settings.thumbnailer.scale+")"}else"showpage"==this._settings.tool?(this._settings.enablepassivepopups=!1,this.geturlparameter("width")?
(this._width=1*this.geturlparameter("width"),this._display.style.width=this._width+"px"):this._width=this._display.offsetWidth,this.geturlparameter("height")?(this._height=1*this.geturlparameter("height"),this._display.style.height=this._height+"px"):this._height=this._display.offsetHeight):(this._width=this._display.offsetWidth,this._height=this._display.offsetHeight);this._loadphase++;browse.switchnextloader();"rasterizer"==this._settings.tool&&(this._settings.recordloading={enabled:!0,recursive:!1});
this.loadjs(this._magazine.bundle+"/"+this._magazine.bundlefile);this.objloaded();break;case 1:browse._toload++;this._settings.recordloading.enabled&&!this._settings.recordloading.recursive&&(this._settings.recordloading.enabled=!1);var c=this._loader.current;for(b in this._widgets)!this._widgets[b]._initialized&&this._widgets[b].init&&this._widgets[b].init(),this._widgets[b]._initialized=!0;if(0==c.cnt)this._loadphase++;else{browse.switchnextloader();for(var d=0;d<c.css.length;d++)this.loadcss(c.css[d]);
for(d=0;d<c.js.length;d++)this.loadjs(c.js[d]);for(d=0;d<c.plugins.length;d++)this.loadjs("plugins/"+c.plugins[d]+".js")}this.objloaded();break;case 2:browse._toload++;this._loadphase++;this._magazine.metadata&&(document.title=this._magazine.metadata.apptitle?this._magazine.metadata.apptitle:this._magazine.metadata.title,(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))&&this._magazine.metadata.splashiphone&&this.addheadlink({rel:"apple-touch-startup-image",href:this._magazine.metadata.splashiphone.portrait}),
navigator.userAgent.match(/iPad/i)&&this._magazine.metadata.splashipad&&this.addheadlink({rel:"apple-touch-startup-image",href:this._magazine.metadata.splashipad.portrait}),this._magazine.metadata.icon&&(this._magazine.metadata.icon.iphone&&this.addheadlink({rel:"apple-touch-icon",href:this._magazine.metadata.icon.iphone}),this._magazine.metadata.icon.ipad&&this.addheadlink({rel:"apple-touch-icon",sizes:"72x72",href:this._magazine.metadata.icon.ipad})));switch(this._settings.tool){case "offline":this.fullscreenmessage("<h1>Welcome to the offline magazine maker tool!</h1>For making your magazine readable offline you need to create a <i>manifest file</i> that lists all the files that have to be kept offline and to link the manifest file in the <i>index.html</i> of your magazine.<br>A quick way for creating a manifest file is to run this line of script from your magazine folder:<br><br><tt>"+
this.htmlentities('(echo "CACHE MANIFEST";echo "# generated at $(date)";for d in "libs" "plugins" "issues/common" "'+this._magazine.bundle+'"; do find "$d" -not -name ".*" -type f ; done) > '+this._magazine.metadata.uid+".cache")+"</tt><br><br>This will create a <i>"+this._magazine.metadata.uid+".cache</i> in your magazine directory with all the files of your magazine. If you need more offline resources, just add them to the list.<br>When your manifest file is ready, open your <i>index.html</i> (or the file you've created for reading your magazine) and add this attribute to the <tt>&lt;HTML&gt;</tt> tag:<br><br><tt>&lt;html <b>manifest=\""+
this._magazine.metadata.uid+'.cache"</b>&gt;</tt><br><br>The magazine will start downloading and the next time its link is opened the magazine browser will automatically show the proper GUI. If you\'re going to update or add files to your magazine, remember to add them to the manifest file or change something into the manifest file too in any case, like changing manually the generation data on the second line of the manifest file - or just running the script line above once again.<br>Your server <i>must</i> serve the manifest file sending the <tt>text/cache-manifest</tt> content type, so make sure that your server is configured properly. If you can\'t access to your server configuration, you can write a little wrapper - depending on the server side scripting language you can use.<br>If your server is supporting PHP, you can proxy your manifest file saving a PHP file containing this simple line of code:<br><br><tt>&lt;?php header("Content-type: text/cache-manifest"); readfile("'+
this._magazine.metadata.uid+'.cache") ?&gt;</tt><br><br>And then pointing this PHP file in the <tt>&lt;HTML&gt;</tt> tag instead of the original manifest file.');break;case "thumbnailer":c="";for(b in this._magazine.data)c+=document.location.href.replace(/\?.*/,"")+"?tool=thumbnail&page="+b+"\n";this.fullscreenmessage("<h1>Welcome to the thumbnailer tool!</h1>Use this file list for creating the pages thumbnail to be used in the index. You can use the Firefox plugin <a style='color:white' href='https://addons.mozilla.org/en-US/firefox/addon/7800/'>Grab Them All</a> (sources <a style='color:white' href='http://code.google.com/p/grabthemall/'>here</a>). Use these settings:<br><br><b>Image format:</b> PNG<br><b>Screenshot type:</b> Grab complete page<br><b>Screen shot file names:</b> Safe URL<br><b>Report file</b> unchecked<br><b>Width</b> "+
Math.floor(this._settings.thumbnailer.originalwidth*this._settings.thumbnailer.scale)+"<br><b>Height</b> "+Math.floor(this._settings.thumbnailer.originalheight*this._settings.thumbnailer.scale)+"<br><br>Other parameters depend on the pages complexity. After grabbing the images you need to rename the image files leaving the page name only. You can automatically rename the image files running this oneliner from the thumbnails folder:<br><br><tt>"+this.htmlentities('ls -1 *.png|sed "s/\\(.*_page_\\)\\(.*\\)/mv \\"\\1\\2\\" \\"\\2\\"/"|sh')+
"</tt><br><br>Then you can copy everything everywhere you like in your issue bundle (i.e. a <i>thumbs</i> directory).<br><br><textarea style='width:100%;' rows=30>"+c+"</textarea>");break;case "rasterizer":c="<h1>Welcome to the rasterize tool!</h1>This tool will try to help you on rasterizing your web pages to images in order to make slower pages faster.<br>The main idea is to create an image for some of the magazine pages (or all of them) instead of having HTML. Though HTML version of the pages is very flexible, allowing a very wide set of layout alignment and adaptions, it could need some calculations that could produce a slow navigation of the magazine on slower devices.<br>Showing just an image of the page is surely less resources-hungry and offers a smoother navigation but <b>it avoids your pages to adapt to the device screen size</b>. That's why I suggest you to rasterize just the pages that are too complex, in order to keep compatibility.<br>On the contrary, if you're going to support just one device or - better - just one resolution, rasterizing everything will ensure the smoothest navigation on that device.<br>Pages will be rendered <b>without any widget</b> and <b>without any object marked with the attribute dontrasterize=yes</b> so, in order to keep the interactive part of the magazine, <b>you must add again the interactive objects over the page image</b> is needed. For that reason I suggest you to keep all dynamic elements on a separated template, usable both in the HTML version and the rasterized one maintaining the same positions. A <i>templates</i> entry, with the <b>dontrasterize:true</b> property set, will be kept as is while rasterizing and will be shown in overlay on the resulting page, so is really handy in these cases.<br>You also can disable rasterization of whole pages in the <i>data</i> section, specifying the <b>dontrasterize:true</b> attribute to JSON structure of the page. (i.e. for whole dynamic pages). If these pages are included into the rasterization phase, it will be kept as is.<br>If you want to include some pages in the <i>data</i> section that are not related with the magazine index into the rasterized version (i.e. modal pages), assign the <b>keeponrasterized:true</b> attribute to that pages in order to copy them on the rasterized magazine.<br>After creating the images of your pages, you have to update your <i>issue.js</i> file accordingly, adding the rasterized pages in the <i>data</i> sections and adding/replacing the HTML version with the new one. A sample <i>issue.js</i> will be generated and can be used as is in most of the cases.<br><br>";
if(this.geturlparameter("device")){var c=c+"Here they are some stuff thant can help you on making the rasterized version of your pages, from page URLs to the page stills with the right resolution to a precomposed issue.js file - you probably have to change something manually. You can use the Firefox plugin <a style='color:white' href='https://addons.mozilla.org/en-US/firefox/addon/7800/'>Grab Them All</a> (sources <a style='color:white' href='http://code.google.com/p/grabthemall/'>here</a>) for making the screenshots automatically. You need to split the image generation phase in two (for landscape and portrait) and change your grabbing settings accordingly to the plugin settings.<br><br>",
e=this._settings.devices[1*this.geturlparameter("device")],f={metadata:this._magazine.metadata,templates:{},versions:{},data:{},version:[],_aliases:{pagemapping:{}}};for(d in this._magazine.version)var g=this._magazine.version[d];var h="",i,j={},l={},h={};for(k in this._magazine.versions)for(m in this._magazine.versions[k].articles)if(d=this.geturlparameter(k+"-"+m)){if(!f.versions[k])for(b in f.versions[k]={articles:{}},"r"==d&&(f.version.push({sizeis:{width:e.landscape.width,height:e.landscape.height},
id:k}),f.version.push({sizeis:{width:e.portrait.width,height:e.portrait.height},id:k}),h[k]=!0),this._magazine.versions[k])f.versions[k][b]||(f.versions[k][b]=this._magazine.versions[k][b]);f.versions[k].articles[m]=this._magazine.versions[k].articles[m];for(b in this._magazine.versions[k].articles[m])for(var n in this._magazine.versions[k].articles[m][b].pages)g=this._magazine.versions[k].articles[m][b].pages[n],g.landscape&&(i=g.landscape),g.portrait&&(tmpp=g.portrait),g.substr&&(tmpp=i=g),this._magazine.data[i].scrollpage||
this._magazine.data[i].dontrasterize||"c"==d?(this.mergepagedata(i,f.templates),f.data[i]=this._magazine.data[i],g=i):(g=this.makerasterizedpagedata(f,"rst_lnd_",i),f._aliases.pagemapping[g]=i,l[i]=!0),this._magazine.data[tmpp].scrollpage||this._magazine.data[tmpp].dontrasterize||"c"==d?(this.mergepagedata(tmpp,f.templates),f.data[tmpp]=this._magazine.data[tmpp],ftmpp=tmpp):(ftmpp=this.makerasterizedpagedata(f,"rst_prt_",tmpp),f._aliases.pagemapping[ftmpp]=tmpp,j[tmpp]=!0),"r"==d&&(f._aliases.pagemapping[i]=
{landscape:g,portrait:ftmpp},f._aliases.pagemapping[tmpp]={landscape:g,portrait:ftmpp},f.versions[k].articles[m][b].pages[n]={landscape:g,portrait:ftmpp})}for(d=0;d<this._magazine.version.length;d++)g=this._magazine.version[d],f.versions[g.id]&&!h[g.id]&&f.version.push(g);for(d in this._magazine.data)i=this._magazine.data[d],i.keeponrasterized&&(this.mergepagedata(d,f.templates),f.data[d]=i);h="// ---\n// This issue file has been generated by "+this._settings.toolname+" rasterizer.\n// ---\n\n";h+=
"// Stylesheets\n\n";for(d=0;d<this._recorder.css.length;d++)h+='browse.addcss("'+this.quoteentities(this._recorder.css[d])+'");\n';h+="\n// Plugins\n\n";for(d=0;d<this._recorder.plugin.length;d++)h+='browse.addplugin("'+this.quoteentities(this._recorder.plugin[d])+'");\n';h+="\n// JS\n\n";for(d=0;d<this._recorder.js.length;d++)h+='browse.addjs("'+this.quoteentities(this._recorder.js[d])+'");\n';h+="\n// Magazine data\n\n";for(b in f)h+="browse._magazine."+b+"="+this.serializer(f[b])+";\n\n";c=c+
("A sample <b>issue.js</b>. Should work as-is but you probably have to change something for handling fallbacks on magazine versions.<br><br><textarea style='width:100%;' rows=30>"+h+"</textarea>")+("<br><br><b>Landscape pages URLs</b>, to be used with Grab Them All. Set your grabbed area to "+e.landscape.width+" x "+e.landscape.height+", save these links on a text file and start processing.<br><br><textarea style='width:100%;' rows=30>");for(d in l)c+=document.location.href.replace(/\?.*/,"")+"?tool=showpage&nowidgets=yes&width="+
e.landscape.width+"&height="+e.landscape.height+"&page="+d+"&nameto=rst_lnd_"+d+"\n";c+="</textarea>";c+="<br><br><b>Portrait pages URLs</b>, to be used with Grab Them All. Set your grabbed area to "+e.portrait.width+" x "+e.portrait.height+", save these links on a text file and start processing.<br><br><textarea style='width:100%;' rows=30>";for(d in j)c+=document.location.href.replace(/\?.*/,"")+"?tool=showpage&nowidgets=yes&width="+e.portrait.width+"&height="+e.portrait.height+"&page="+d+"&nameto=rst_prt_"+
d+"\n";c+="</textarea>";c+="<br><br>After all the rasterized pages have been saved, run this line from your your output folder:<br><br><tt>";c+=this.htmlentities('ls -1 *.png|sed "s/\\(.*_nameto_\\)\\(.*\\)/mv \\"\\1\\2\\" \\"\\2\\"/"|sh');c+='</tt><br><br>and move all the images to the "'+this._magazine.bundle+'/rasterized" folder.'}else{var c=c+"First setup the rasterization parameters.<br><br>",k;for(k in this._magazine.versions){var c=c+("<b>Version "+k+"</b><ul>"),m;for(m in this._magazine.versions[k].articles)c+=
"<li><select id='"+k+"-"+m+"'>",c+="<option value=''>Exclude</option>",c+="<option value='c'>Copy</option>",c+="<option value='r'>Rasterize</option>",c+="</select> Section "+m+"</li>";c+="</ul>"}c+="<input type='button' onclick='browse.rasterizersetall(0)' value='Exclude all'> <input type='button' onclick='browse.rasterizersetall(1)' value='Copy all'> <input type='button' onclick='browse.rasterizersetall(2)' value='Rasterize all'><br><br>";c+="<b>Device: <select id='resolution'>";for(d=0;d<this._settings.devices.length;d++)c+=
"<option value='device="+d+"'>"+this._settings.devices[d].label+"</option>";c+="</select><br><br>";c+="<input type=button value='Start' onclick=\"browse.rasterizerstart()\">"}this.fullscreenmessage(c);break;case "index":c=this._magazine.metadata.title+" index:<br><ul>";for(b in this._magazine.data)c+="<li><b>"+b+"</b> [<a style='color:white' href='?tool=thumbnail&page="+b+"'>Thumbnail</a>] [<a style='color:white' href='?tool=showpage&page="+b+"'>Single page</a>]</li>";c+="</ul>";this.fullscreenmessage(c);
break;default:"boxmaker"==this._settings.tool&&(this._boxmaker.enabled=!0,this.passivepopup(this._settings.passivepopups.boxmaker.ready),browse.addEventListener(window,"keyup",this.boxmakerkeyhandler));if("thumbnail"==this._settings.tool||"showpage"==this._settings.tool){b={title:"Article title",subtitle:"Article subtitle",pages:[]};c=this.geturlparameter("page");if(e=this.findpage(null,null,null,c))b=e.article;this._magazine.version=[{id:"thumbnail"}];this._magazine.versions.thumbnail={metadata:{dontsavepositions:!0},
sections:[{id:"section",label:"Section",title:"Section title",subtitle:"Section subtitle"}],articles:{section:[b]}};this._magazine.versions.thumbnail.articles.section[0].pages=[c]}this.makescrollbar();this.makebullets();this.decideversion();this.makepages();this.makemodal();this.makeshadowbox();this.makegui();this.pagechanged();this.relayoutall(!1);this.customevents(!1);"thumbnail"!=this._settings.tool&&this.applytouchevents(this._display,browse.__touchstart,browse.__touchmove,browse.__touchend,!0);
this.objloaded()}this.dismissloadingscreen();break;default:this._loadphase=1E3}},rasterizerstart:function(){var b="&",c,d,e;for(e in this._magazine.versions)for(var f in this._magazine.versions[e].articles)c=e+"-"+f,(d=browse.getcombovalue(c))&&(b+=c+"="+d+"&");document.location.href+=b+browse.getcombovalue("resolution")},rasterizersetall:function(b){var c,d;for(d in this._magazine.versions)for(var e in this._magazine.versions[d].articles)c=d+"-"+e,document.getElementById(c).selectedIndex=b},boxmakeraddbox:function(b){var c=
this._pagestack.topmostpage.pageid;this._boxmaker.data[c]||(this._boxmaker.data[c]=[]);this._boxmaker.data[c].push({x:b.x,y:b.y,w:b.w,h:b.h});browse.passivepopup({id:"boxmakerboxadded",text:"Box added to the page:<br><br><b>At:</b> "+b.x+","+b.y+"<br><b>Width:</b> "+b.w+"<br><b>Height:</b> "+b.h+"<br><br><b>Page:</b><br>"+c,style:{backgroundColor:"#ffa0a0",color:"#000000"}})},boxmakerdeletebox:function(b){this._boxmaker.boxeditor.currentdata=this._boxmaker.boxeditor.currentdata.splice(b,1);this.boxmakershoweditor()},
boxmakershoweditor:function(){this.boxmakercanceleditor();this._boxmaker.editing=2;var b=this._pagestack.topmostpage.pageid;this._boxmaker.boxeditor.currentdata=this._boxmaker.data[b];this._boxmaker.boxeditor.bg||(this._boxmaker.boxeditor.bg=document.createElement("div"),this._boxmaker.boxeditor.bg.style.position="absolute",this._boxmaker.boxeditor.bg.style.zIndex=999999,this._boxmaker.boxeditor.bg.style.backgroundColor="#000000",this._boxmaker.boxeditor.bg.style.opacity=0.2,this._boxmaker.boxeditor.bg.style.left=
"0px",this._boxmaker.boxeditor.bg.style.top="0px",this._boxmaker.boxeditor.bg.style.width="100%",this._boxmaker.boxeditor.bg.style.height="100%",this.applytouchevents(this._boxmaker.boxeditor.bg,this.__touchstart,this.__touchmove,this.__touchend,!0));document.body.appendChild(this._boxmaker.boxeditor.bg);this._boxmaker.boxeditor.boxes=[];if(this._boxmaker.data[b])for(var c=0;c<this._boxmaker.data[b].length;c++){var d=document.createElement("div");d.style.position="absolute";d.style.zIndex=1999999;
d.style.backgroundColor="#000000";d.style.border="1px dashed #ff0000";d.style.opacity=0.5;d.style.left=this._boxmaker.data[b][c].x+"px";d.style.top=this._boxmaker.data[b][c].y+"px";d.style.width=(2<this._boxmaker.data[b][c].w?this._boxmaker.data[b][c].w-2:1)+"px";d.style.height=(2<this._boxmaker.data[b][c].h?this._boxmaker.data[b][c].h-2:1)+"px";d.setAttribute("boxid",c);this.applytouchevents(d,this.__touchstart,this.__touchmove,this.__touchend,!0);document.body.appendChild(d);this._boxmaker.boxeditor.boxes.push(d)}},
boxmakercanceleditor:function(){if(2==this._boxmaker.editing){this._boxmaker.boxeditor.bg&&document.body.removeChild(this._boxmaker.boxeditor.bg);if(this._boxmaker.boxeditor.boxes)for(var b=0;b<this._boxmaker.boxeditor.boxes.length;b++)document.body.removeChild(this._boxmaker.boxeditor.boxes[b]),delete this._boxmaker.boxeditor.boxes[b];this._boxmaker.editing=0}},boxmakerkeyhandler:function(b){if(browse._boxmaker.currentrect)browse.passivepopup(browse._settings.passivepopups.boxmaker.dragging);else switch(b.keyCode){case 66:browse.boxmakercanceleditor();
browse._boxmaker.editing=0;browse.passivepopup(browse._settings.passivepopups.boxmaker.browse);break;case 65:browse.boxmakercanceleditor();browse._boxmaker.editing=1;browse.passivepopup(browse._settings.passivepopups.boxmaker.add);break;case 69:2==browse._boxmaker.editing?(browse.boxmakercanceleditor(),browse._boxmaker.editing=0,browse.passivepopup(browse._settings.passivepopups.boxmaker.browse)):(browse.passivepopup({id:"boxmakerunbrowse",text:"Boxmaker in <b>edit mode</b>.<br>Click on boxes to delete.<br><br><b>Page:</b><br>"+
browse._pagestack.topmostpage.pageid,style:{backgroundColor:"#ffa0a0",color:"#000000"}}),browse.boxmakershoweditor());break;case 83:browse.boxmakercanceleditor();if(3==browse._boxmaker.editing){var b={},c;for(c in browse._boxmaker.data)if(browse._boxmaker.data[c]&&browse._boxmaker.data[c].length){browse._magazine.data[c].template||(browse._magazine.data[c].template=[]);browse._magazine.data[c].template.push("boxmaker_"+c);browse._magazine.templates["boxmaker_"+c]={keeponrasterized:!0,file:browse._magazine.bundle+
"/boxmaker-"+c+".html"};b[c]="";for(var d=0;d<browse._boxmaker.data[c].length;d++)b[c]+='<div interactive="yes" onobjecttap="browse.passivepopup({text:\'Placeholder action!\'})" style="opacity:0.5;background-color:#ff0000;color:#ffffff;overflow:hidden;position:absolute;left:'+browse._boxmaker.data[c][d].x+"px;top:"+browse._boxmaker.data[c][d].y+"px;width:"+browse._boxmaker.data[c][d].w+"px;height:"+browse._boxmaker.data[c][d].h+'px;">Box '+(d+1)+"</div>\n"}d="<h1>Welcome to the boxmaker save mode!</h1>The boxes you've added to your magazine will be exported as translucent coloured DIVs with a defined default action on tap/click. You can change the action and remove the background color and opacity values to add invisible interactivity to your page or histance a plugin in it in order to add galleries and more interactive objects using the <tt>widget='widgetname'</tt> attribute.<br><br>"+
("Replace these <i>browse._magazine</i> sections in your <tt>"+browse._magazine.bundle+"/issue.js</tt> file and create the next files as indicated.<br><br>");d+="<b>Templates section:</b><br><textarea style='width:80%;' rows=30>browse._magazine.templates="+browse.serializer(browse._magazine.templates)+";</textarea><br>";d+="<b>Data section:</b><br><textarea style='width:80%;' rows=30>browse._magazine.data="+browse.serializer(browse._magazine.data)+";</textarea><br>";for(c in b)d+="<b>File "+browse._magazine.bundle+
"/boxmaker-"+c+".html</b><br><textarea style='width:80%;' rows=30>"+b[c]+"</textarea><br>";browse.fullscreenmessage(d)}else browse._boxmaker.editing=3,browse.passivepopup(browse._settings.passivepopups.boxmaker.save);break;default:3==browse._boxmaker.editing&&(browse._boxmaker.editing=0),browse.boxmakercanceleditor(),browse.passivepopup(browse._settings.passivepopups.boxmaker.quickhelp)}},benchmarkended:function(){var b=browse._hardware.objs.cycles==browse._hardware.objs.cycled,c=1500>=new Date-this._hardware.objs.started-
10*this._hardware.objs.cycles;return b||!c?(this._hardware.passed=c&&b,this._hardware.passed||(this._hardware.boxshadow=null),!0):!1},cyclebenchmark:function(){var b=browse._hardware.objs.shadowtest.offsetWidth+browse._hardware.objs.shadowtest.offsetHeight;browse._hardware.objs.sum!=b&&(browse._hardware.objs.cycled++,browse._hardware.objs.sum=b);browse._hardware.objs.shadowtest.style.left=10*Math.random()+"%";browse._hardware.objs.shadowtest.style.top=10*Math.random()+"%";browse._hardware.objs.shadowtest.style.width=
10*Math.random()+"%";browse._hardware.objs.shadowtest.style.height=10*Math.random()+"%";browse.benchmarkended()?browse.endbenchmark():setTimeout(browse.cyclebenchmark,1)},endbenchmark:function(){this._display.removeChild(this._hardware.objs.shadowtest);delete this._hardware.objs;this.doloadphase()},benchmark:function(b){var c=document.body.style;void 0!==c.transform?this._hardware.transform={js:"transform",style:"transform"}:void 0!==c.WebkitTransform?this._hardware.transform={js:"WebkitTransform",
style:"-webkit-transform"}:void 0!==c.MozTransform&&(this._hardware.transform={js:"MozTransform",style:"-moz-transform"});void 0!==c.OTransform&&(this._hardware.transform={js:"OTransform",style:"-o-transform"});void 0!==c.boxShadow?this._hardware.boxshadow={js:"boxShadow",style:"box-shadow"}:void 0!==c.WebkitBoxShadow?this._hardware.boxshadow={js:"WebkitBoxShadow",style:"-webkit-box-shadow"}:void 0!==c.MozBoxShadow?this._hardware.boxshadow={js:"MozBoxShadow",style:"-moz-box-shadow"}:void 0!==c.OBoxShadow&&
(this._hardware.boxshadow={js:"OBoxShadow",style:"-o-box-shadow"});void 0!==c.borderRadius?this._hardware.borderradius={js:"borderRadius",style:"border-radius"}:void 0!==c.WebkitBorderRadius?this._hardware.borderradius={js:"WebkitBorderRadius",style:"-webkit-border-radius"}:void 0!==c.MozBorderRadius?this._hardware.borderradius={js:"MozBorderRadius",style:"-moz-border-radius"}:void 0!==c.OBorderRadius&&(this._hardware.borderradius={js:"OBorderRadius",style:"-o-border-radius"});void 0!==c.transitionProperty?
this._hardware.transitionproperty={js:"transitionProperty",style:"transition-property"}:void 0!==c.WebkitTransitionProperty?this._hardware.transitionproperty={js:"WebkitTransitionProperty",style:"-webkit-transition-property"}:void 0!==c.MozTransitionProperty?this._hardware.transitionproperty={js:"MozTransitionProperty",style:"-moz-transition-property"}:void 0!==c.OTransitionProperty&&(this._hardware.transitionproperty={js:"OTransitionProperty",style:"-o-transition-property"});void 0!==c.backfaceVisibility?
this._hardware.backfacevisibility={js:"backfaceVisibility",style:"backface-visibility"}:void 0!==c.WebkitBackfaceVisibility?this._hardware.backfacevisibility={js:"WebkitBackfaceVisibility",style:"-webkit-backface-visibility"}:void 0!==c.MozBackfaceVisibility?this._hardware.backfacevisibility={js:"MozBackfaceVisibility",style:"-moz-backface-visibility"}:void 0!==c.OBackfaceVisibility&&(this._hardware.backfacevisibility={js:"OBackfaceVisibility",style:"-o-backface-visibility"});c=document.createElement("div");
c.setAttribute("ontouchstart","return;");this._hardware.touchenabled="function"==typeof c.ontouchstart;this._hardware.uselocalstorage=this._settings.uselocalstorage;if(this._hardware.uselocalstorage&&(!window.localStorage||"file:"==window.location.protocol))this._hardware.uselocalstorage=!1;b?this.doloadphase():(this._hardware.objs={cycles:100,cycled:0,sum:-1,started:new Date,shadowtest:null},this._hardware.objs.shadowtest=document.createElement("div"),this._hardware.objs.shadowtest.style.position=
"absolute",this._hardware.objs.shadowtest.style.zIndex=0,this._hardware.objs.shadowtest.style.height="30%",this._hardware.objs.shadowtest.style.width="30%",this._hardware.objs.shadowtest.style.zIndex=10001,this._hardware.objs.shadowtest.style.backgroundColor="black",this._hardware.boxshadow&&(this._hardware.objs.shadowtest.style[this._hardware.boxshadow.js]="8px 8px 8px #000"),this._hardware.objs.shadowtest.style.color="#000000",this._hardware.objs.shadowtest.innerHTML="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ullamcorper posuere tristique. Nulla bibendum risus a tellus condimentum mattis. Etiam vestibulum felis at mi consectetur fringilla. Donec quis augue non nibh porttitor porta quis nec nisl. Vivamus at mauris orci. Cras bibendum porta consequat. Vestibulum eget semper nisi. Vivamus lorem lectus, congue sit amet semper ut, egestas nec nisi. Mauris eu placerat libero. Pellentesque in dui turpis, a consequat eros. Etiam convallis est quis turpis bibendum eu gravida massa euismod. Proin in odio dui, sed rhoncus quam. Phasellus luctus, felis ut rutrum tristique, libero velit vehicula mauris, condimentum consectetur ipsum leo iaculis ipsum. Phasellus tempus est non enim pharetra mollis. Quisque quis nulla quis tellus suscipit auctor quis in nulla. Curabitur facilisis aliquet velit in rutrum. Fusce placerat consectetur enim, in volutpat odio aliquam nec. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ullamcorper posuere tristique. Nulla bibendum risus a tellus condimentum mattis. Etiam vestibulum felis at mi consectetur fringilla. Donec quis augue non nibh porttitor porta quis nec nisl. Vivamus at mauris orci. Cras bibendum porta consequat. Vestibulum eget semper nisi. Vivamus lorem lectus, congue sit amet semper ut, egestas nec nisi. Mauris eu placerat libero. Pellentesque in dui turpis, a consequat eros. Etiam convallis est quis turpis bibendum eu gravida massa euismod. Proin in odio dui, sed rhoncus quam. Phasellus luctus, felis ut rutrum tristique, libero velit vehicula mauris, condimentum consectetur ipsum leo iaculis ipsum. Phasellus tempus est non enim pharetra mollis. Quisque quis nulla quis tellus suscipit auctor quis in nulla. Curabitur facilisis aliquet velit in rutrum. Fusce placerat consectetur enim, in volutpat odio aliquam nec. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ullamcorper posuere tristique. Nulla bibendum risus a tellus condimentum mattis. Etiam vestibulum felis at mi consectetur fringilla. Donec quis augue non nibh porttitor porta quis nec nisl. Vivamus at mauris orci. Cras bibendum porta consequat. Vestibulum eget semper nisi. Vivamus lorem lectus, congue sit amet semper ut, egestas nec nisi. Mauris eu placerat libero. Pellentesque in dui turpis, a consequat eros. Etiam convallis est quis turpis bibendum eu gravida massa euismod. Proin in odio dui, sed rhoncus quam. Phasellus luctus, felis ut rutrum tristique, libero velit vehicula mauris, condimentum consectetur ipsum leo iaculis ipsum. Phasellus tempus est non enim pharetra mollis. Quisque quis nulla quis tellus suscipit auctor quis in nulla. Curabitur facilisis aliquet velit in rutrum. Fusce placerat consectetur enim, in volutpat odio aliquam nec.",
this._display.appendChild(this._hardware.objs.shadowtest),this.cyclebenchmark())},passivepopuptoggle:function(){browse._passivepopup.obj.style.display="none"},passivepopup:function(b){if(browse._settings.enablepassivepopups&&(b||(b=browse._passivepopup.state),b&&!b.ignore&&(browse._passivepopup.state=b,browse._passivepopup.obj)))if(b.text){browse._passivepopup.obj.style.display="block";browse._passivepopup.obj.innerHTML=b.text;browse._passivepopup.tout&&clearTimeout(browse._passivepopup.tout);b.keep||
(browse._passivepopup.tout=setTimeout(browse.passivepopuptoggle,b.time?b.time:2E3));if(b.onshow)b.onshow();if(b.style)for(a in b.style)browse._passivepopup.obj.style[a]=b.style[a]}else browse._passivepopup.obj.style.display="none"},passivepopupclicked:function(){if(browse._passivepopup.state.onclick)browse._passivepopup.state.onclick()},dismissloadingscreen:function(){browse._loadingscreen.time-=0.1;browse._loadingscreen.obj.style.opacity=1<browse._loadingscreen.time?1:browse._loadingscreen.time;
0>=browse._loadingscreen.time?(browse._display.removeChild(browse._loadingscreen.obj),browse._loadingscreen=null):setTimeout(browse.dismissloadingscreen,10)},resize:function(){this._boxmaker.enabled&&this.boxmakercanceleditor();this._display&&1E3==this._loadphase&&(this._width=this._display.offsetWidth,this._height=this._display.offsetHeight,this.decideversion(),this.relayoutall(!0))},restorecurrentpage:function(){var b=this.loadsetting(!0,"currentpage"),c=!1;b&&(b=b.split("|"),b[0]==this._magazine.metadata.version&&
b[1]==this._current.magazineversionid&&(this.jumpto(b[2],parseInt(b[3]),parseInt(b[4])),c=!0));c||this.jumpto(this._magazine.versions[this._current.magazineversionid].sections[0].id,0,0)},savecurrentpage:function(){this._current.magazineversion.metadata.dontsavepositions||this.savesetting(!0,"currentpage",this._magazine.metadata.version+"|"+this._current.magazineversionid+"|"+this._current.sectionid+"|"+this._current.horizontal+"|"+this._current.vertical)},offlineevent:function(b){var c=null;b&&b.type&&
(c=navigator.onLine?"error"==b.type&&navigator.standalone?browse._settings.passivepopups.offlinestorageonline.errorbm:browse._settings.passivepopups.offlinestorageonline[b.type]:browse._settings.passivepopups.offlinestorageoffline[b.type]);0<browse._settings.debug&&console.log("New state:["+b.type+","+window.applicationCache.status+"]",c);browse.passivepopup(c)},init:function(b,c,d){d&&(this._magazine.bundlefile=d);this.addEventListener(window,"load",function(){browse._init(b,c)});this.addEventListener(window,
"resize",function(){browse.resize()});window.applicationCache&&(this.addEventListener(window.applicationCache,"cached",this.offlineevent),this.addEventListener(window.applicationCache,"checking",this.offlineevent),this.addEventListener(window.applicationCache,"downloading",this.offlineevent),this.addEventListener(window.applicationCache,"error",this.offlineevent),this.addEventListener(window.applicationCache,"noupdate",this.offlineevent),this.addEventListener(window.applicationCache,"obsolete",this.offlineevent),
this.addEventListener(window.applicationCache,"progress",this.offlineevent),this.addEventListener(window.applicationCache,"updateready",this.offlineevent));return ret},_init:function(b,c){document.title="Welcome to "+this._settings.toolname+".";document.body.style.WebkitTextSizeAdjust="none";document.body.style.WebkitUserSelect="none";document.body.style.MozUserSelect="none";document.body.style.WebkitTouchCallout="none";document.body.style.WebkitTapHighlightColor="rgba(0,0,0,0)";document.body.style.cursor=
"pointer";document.body.style.margin=0;this._display=document.getElementById(b);this._display.style.overflow="hidden";this._loadingscreen.obj=document.createElement("div");this._loadingscreen.obj.style.position="absolute";this._loadingscreen.obj.className="loadingscreen";this._loadingscreen.obj.id="_loadingscreen";this._loadingscreen.obj.style.zIndex=1E4;this._loadingscreen.obj.style.left=0;this._loadingscreen.obj.style.top=0;this._loadingscreen.obj.style.width="100%";this._loadingscreen.obj.style.height=
"100%";this._loadingscreen.obj.style.background="#000000 url('libs/spinner.gif') no-repeat scroll center";this._display.appendChild(this._loadingscreen.obj);this._passivepopup.obj=document.createElement("div");this._passivepopup.obj.style.display="none";this._passivepopup.obj.style.position="absolute";this._passivepopup.obj.style.right="5px";this._passivepopup.obj.style.top="5px";this._passivepopup.obj.style.fontFamily="helvetica";this._passivepopup.obj.style.zIndex=10001;this._passivepopup.obj.style.padding=
"5px";this._passivepopup.obj.style.backgroundColor="red";this._passivepopup.obj.style.fontSize="10px";this._passivepopup.obj.style.border="1px solid #000000";this.applytouchevents(this._passivepopup.obj,null,null,this.passivepopupclicked,!0);this._display.appendChild(this._passivepopup.obj);this._magazine.bundle=c;this._settings.tool=this._settings.enabletools?this.geturlparameter("tool"):null;this.geturlparameter("skipdelays")&&(this._settings.skipdelays=this.geturlparameter("skipdelays"));this.geturlparameter("nowidgets")&&
(this._settings.nowidgets=this.geturlparameter("nowidgets"));"help"==this._settings.tool?this.fullscreenmessage("<h1>Welcome to the "+this._settings.toolname+" tools help!</h1><tt><a style='color:white' href='?skipdelays=yes'>skipdelays=yes</a></tt> For skipping delays while loading or opening modals. Useful while developing and designing pages ;)<br><tt><a style='color:white' href='?tool=help'>tool=help</a></tt> For this guide.<br><tt><a style='color:white' href='?tool=offline'>tool=offline</a></tt> For instructions to make your magazine readable offline.<br><tt><a style='color:white' href='?tool=rasterizer'>tool=rasterize</a></tt> For instructions to rasterize all your magazine pages in order to make it faster but specialized on a specific device.<br><tt><a style='color:white' href='?tool=thumbnailer'>tool=thumbnailer</a></tt> For instructions to make page thumbnails to be used in your magazine (tipically in the index).<br><tt><a style='color:white' href='?tool=index'>tool=index</a></tt> Creates an handy index for developers/designers. There are mainly shortcuts for the parameters below.<br><tt><a style='color:white' href='?tool=boxmaker'>tool=boxmaker</a></tt> Enables the boxmaker tool that can help on creating the widget overlay on your rasterized pages. You can read a quick quide <a style='color:white' href='?tool=boxmakerhelp'>here</a>.<br><tt>tool=thumbnail&page=<i>[page id]</i></tt> For the <i>page id</i> thumbnail image. To be used with <i>thumbnailer</i> tool.<br><tt>tool=showpage&page=<i>[page id]</i></tt> Shows only <i>page id</i>, without the rest of the magazine.<br><br><hr><i>"+
this._settings.toolname+"</i> is "+this._settings.toollicense+" licensed. &copy;2011 KesieV - <a style='color:white' href='http://www.kesiev.com'>http://www.kesiev.com</a>"):"boxmakerhelp"==this._settings.tool?this.fullscreenmessage("<h1>Welcome to the boxmaker tool help!</h1><i>boxmaker</i> is a tool that can help you on making an interactive overlay for your rasterized magazine.<br>The concept behind interactive layers is pretty simple. Magaka can stack many HTML files and images one over another one and the result is shown to the user. If you've just an image of your magazine page, you can put an invisible layer with interactive widgets over that image, defining some <i>sensible areas</i> that can be used for many purposes, like showing widgets or making links between pages.<br><br>I suggest to start working with <i>boxmaker</i> when your whole magazine is already readable on Magaka, so your <i>index.html</i> file and the <i>issue.js</i> file are ready. Moreover is easier to work with <i>boxmaker</i> on a browser view that have the same size of your exported images so another suggestion is to use <i>boxmaker</i> into the <i>Device Tester</i> tool included in Magaka. You can open the <i>boxmaker</i> tool pointing to your <i>index.html</i> file and appending the <a style='color:#ffffff' href='?tool=boxmaker'>?tool=boxmaker</a> parameter (just make sure that tools has been enabled from settings).<br>Your magazine will be opened on the browser as usual but some keyboard commands will be enabled.<ul><li><b>A</b> key: <i>add mode</i>. Add a new box on the current page. To create a box just drag and drop with your mouse - a dashed rectangle will show the selected area. After dropping, the box becomes invisible and is added to the page.</li><li><b>E</b> key: <i>edit mode</i>. Shows the rectange defined in the current page. Click a rectangle to delete it. Hit any key to exit the <i>edit mode</i>.</li><li><b>B</b> key: <i>browse mode</i>. The editor is disabled so you can navigate to another page. Once reached the page you want to delete, just hit the A or E key.</li><li><b>S</b> key: <i>save mode</i>. Hitting the S key twice, the boxmaker tool is closed and some chuncks of code are generated. Just follow the on-screen instructions to apply the defined boxes to your magazine.</li></ul>The code generated by the <i>save mode</i> includes some parts to be replaced to your <i>issue.js</i> file and a bunch of new HTML files to be created. The created files will be used to show some translucent coloured and numbered DIVs over the already existing rasterized pages with a predefined action performed when tapped/clicked and at the same position you've defined into the boxmaker tool. After that you can change any of the rectangles behaviour, removing background colour, opacity and text and making them invisible but still clickable or assigning a widget on that area, in order to add interactive elements like blackboards and slideshows.<br>You will be able to change the boxes left, top, width and height attributes if you need to do some fine tuning. I suggest you to use the <a style='color:#ffffff' href='?tool=index'>index tool</a> for progressively seeing your changes quicker."):
this._settings.tool||this._settings.skipdelays?(this._loadingscreen.time=0,this.benchmark(!0)):(this._loadingscreen.time=this._settings.loadingscreen.delay,this.benchmark());return 5},adjustscrollablepages:function(){return this._current.pagedata&&this._current.pagedata.scrollpage&&-this._yscroll-this._baseyscroll+this._height>this._currentpage.obj.offsetHeight?(this._baseyscroll=-this._currentpage.obj.offsetHeight+this._height,this._yscroll=0,!0):!1},relayoutall:function(b){this.updatecurrent();
this.resizepage(this._firstpage,b);this.resizepage(this._currentpage,b);this.resizepage(this._nextpage,b);this.resizepage(this._upperpage,b);this.resizepage(this._lowerpage,b);this.updatepage(this._currentpage);this.setcontenttopages();this.adjustscrollablepages();this.layoutpages();this._modalbox.displayed&&(this.resizepage(this._modalbox,b),this.setcontenttomodal(),this.updatepage(browse._modalbox),this.layoutmodal());this.layoutbullets();this.layoutgui();this.updategui()},gotosheet:function(b,
c,d){if(this.isbrowseridle()){var e=!1;null==b&&(b=this._current.sectionid);b!=this._current.sectionid&&(e=!0);"right"==c?c=this._current.horizontal+1:"left"==c?c=this._current.horizontal-1:"top"==c?c=0:"bottom"==c&&(c=this._current.magazineversion.articles[b].length-1);null!=c?0>c?c=0:c>this._current.magazineversion.articles[b].length-1&&(c=this._current.magazineversion.articles[b].length-1):c=this._current.horizontal;"up"==d?d=(e?1:this.getvert(c))-1:"down"==d?d=(e?-1:this.getvert(c))+1:"top"==
d?d=0:"bottom"==d&&(d=this._current.magazineversion.articles[b][c].pages.length-1);null!=d?(0>d&&(d=0),d>this._current.magazineversion.articles[b][c].pages.length-1&&(d=this._magazine.versions[this._current.magazineversionid].articles[b][c].pages.length-1)):d=e?0:this.getvert(c);this._travel={horizontal:c,vertical:d,sectionid:b};this.starttravel()}},gotopage:function(b,c){var c=this.solvepagealias(c),d=this.findpage(this._current.magazineversionid,b,null,c);d&&this.gotosheet(b,d.horizontal,d.vertical)},
solvepagealias:function(b){if(browse._magazine._aliases){var c=browse._magazine._aliases.pagemapping[b];return c?c.substr?c:c.landscape&&this.islandscape()?c.landscape:c.portrait&&!this.islandscape()?c.portrait:b:b}return b},reloadmagazine:function(){document.location.href=document.location.href},addheadlink:function(b){var c=document.createElement("link"),d;for(d in b)c.setAttribute(d,b[d]);document.getElementsByTagName("head")[0].appendChild(c)},quoteentities:function(b){return b.replace(/"/g,'\\"').replace(/\n/g,
"\\n").replace(/\r/g,"\\r")},serializer:function(b,c){var c=c?c:"",d=c+"\t",e="",e=typeof b;if(null==b)e="null";else if("string"==e)e='"'+this.quoteentities(b)+'"';else if("number"==e)e=b;else if("boolean"==e)e=b?"true":"false";else if("function"==e)e=b;else{var f,e=b.constructor==Array?[!0,"[","]"]:[!1,"{","}"];f=0;var g,h=e[1]+"\n",i;for(i in b)f++,g=(e[0]?"":i+":")+browse.serializer(b[i],d),h+=d+g+",\n";e=0==f?e[1]+e[2]:1==f?e[1]+g+e[2]:h.substr(0,h.length-2)+"\n"+c+e[2]}return e},findpage:function(b,
c,d,e){var f=!1,g;for(g in this._magazine.versions){if(g==b||void 0==b)for(var h in this._magazine.versions[g].articles){if(h==c||void 0==c)for(var i in this._magazine.versions[g].articles[h]){if(this._magazine.versions[g].articles[h][i].title==d||void 0==d)for(var j in this._magazine.versions[g].articles[h][i].pages){var l=this._magazine.versions[g].articles[h][i].pages[j];if(l==e||l.portrait&&l.portrait==e||l.landscape&&l.landscape==e){f={horizontal:1*i,vertical:1*j,idversion:g,idsection:h,article:this._magazine.versions[g].articles[h][i]};
break}}if(f)break}if(f)break}if(f)break}return f},makerasterizedpagedata:function(b,c,d){c+=d;b.data[c]={image:this._magazine.bundle+"/rasterized/"+c+".png"};var e=this.mergepagedata(d,b.templates,!0);if(e.length){b.data[c].template=e;for(var f in this._magazine.data[d])b.data[c][f]||(b.data[c][f]=this._magazine.data[d][f])}return c},mergepagedata:function(b,c,d){var e=[];if(this._magazine.data[b].template)for(var f=0;f<this._magazine.data[b].template.length;f++){var g=this._magazine.data[b].template[f],
h=this._magazine.templates[g];if(!d||h.keeponrasterized)c[g]=h,e.push(g)}return e},getcombovalue:function(b){return document.getElementById(b)[document.getElementById(b).selectedIndex].value},isbrowseridle:function(){return!browse._loadingscreen&&!this._springing&&!this._animatinggui&&!this._travel&&!this._modalbox.animating&&1E3==this._loadphase&&!browse._boxmaker.editing},islandscape:function(){return this._width>this._height},makepage:function(b){var c=document.createElement("div");c.id=b;c.style.position=
"absolute";c.style.display="none";c.style.left="0px";c.style.top="0px";c.style.overflow="hidden";c.style.zIndex=1;return c},geturldata:function(b){0<=b.indexOf("nocache=yes")&&(this._webcache[b]=null);if(!this._webcache[b]){0<this._settings.debug&&console.log("Loading DATA: "+b);var c=this.createXmlHttpRequest();c.open("GET",b,!1);c.send(null);this._webcache[b]=c.responseText}return this._webcache[b]},displaceobject:function(b,c,d){null==browse._hardware.transform?(b.style.left=c+"px",b.style.top=
d+"px"):b.style[browse._hardware.transform.js]="translate("+c+"px,"+d+"px)"},addEventListener:function(b,c,d){b.addEventListener?b.addEventListener(c,d,!1):b.attachEvent("on"+c,d)},createXmlHttpRequest:function(){var b=!1;if(!b)try{b=new XMLHttpRequest}catch(c){b=!1}if("undefined"!=typeof ActiveXObject){if(!b)try{b=new ActiveXObject("MSXML2.XMLHTTP")}catch(d){b=!1}if(!b)try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){b=!1}}if(!b)try{b=createRequest()}catch(f){b=!1}return b},htmlentities:function(b){for(var b=
b+"",c="",d,e=0;e<b.length;e++)d=b.charAt(e).charCodeAt(0),10==d&&(c+="<br>"),c=32==d?c+"&nbsp;":c+("&#x"+d.toString(16)+";");return c},geturlparameter:function(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");b=RegExp("[\\?&]"+b+"=([^&#]*)").exec(window.location.href);return null==b?"":b[1]},fullscreenmessage:function(b){var c=document.createElement("div");document.body.style.WebkitUserSelect="auto";document.body.style.MozUserSelect="auto";c.style.position="absolute";c.style.zIndex=1E4;c.style.left=
0;c.style.top=0;c.style.padding="10px";c.style.backgroundColor="black";c.style.color="white";c.innerHTML=b;document.body.appendChild(c);document.body.removeChild(this._display)},getsettingkey:function(b,c){return(b?this._magazine.metadata.uid+"_":"")+c},savesetting:function(b,c,d){var e=!1;if(this._hardware.uselocalstorage)try{localStorage[this.getsettingkey(b,c)]=d}catch(f){e=!0}if(!this._hardware.uselocalstorage||e)document.cookie=this.getsettingkey(b,c)+"="+(d?d:"; expires=-1")+"; path=/"},loadsetting:function(b,
c){var d=null,e=!1;if(this._hardware.uselocalstorage)try{d=localStorage[this.getsettingkey(b,c)]}catch(f){e=!0}if(!this._hardware.uselocalstorage||e){for(var d=this.getsettingkey(b,c)+"=",e=document.cookie.split(";"),g=0;g<e.length;g++){for(var h=e[g];" "==h.charAt(0);)h=h.substring(1,h.length);if(0==h.indexOf(d))return h.substring(d.length,h.length)}return null}return d}},widget={gotosheet:function(b,c,d){browse.gotosheet(b,c,d)},gotopage:function(b,c){browse.gotopage(b,c)},togglemodal:function(){browse.togglemodal(!0)},
hidemodal:function(){browse._modalbox&&browse._modalbox.displayed&&browse.togglemodal(!0)},showmodal:function(b,c){browse.showmodal(b,c)},pagesizechanged:function(){browse.adjustscrollablepages();browse.layoutpages()},commonpassivepopup:function(b){browse.passivepopup(browse._settings.passivepopups.common[b])},passivepopup:function(b){browse.passivepopup(b)},isonline:function(){return navigator.onLine},getcontext:function(b){return browse._widgetdata[b.getAttribute("id")]},setcontext:function(b,c){browse._widgetdata[b.getAttribute("id")]=
c},broadcastevent:function(b,c,d){browse.broadcastevent(b.containerpage,c,d)},schedule:function(b,c,d,e,f){return browse.schedule(b.containerpage,c,d,e,f)},removeschedule:function(b,c){browse.removeschedule(b.containerpage,c)},removeobjectschedules:function(b){browse.removeobjectschedules(b.containerpage,b)},getpagelock:function(){return browse.getpagelock()},setpagelock:function(b){return browse.setpagelock(b)},togglepagelock:function(){return browse.togglepagelock()},makewidget:function(b,c){browse.makewidget(b,
c)},touchedobject:function(b,c,d){for(var e=0;e<b.childNodes.length;e++){var f=b.childNodes[e];if(f.getAttribute&&f.getAttribute(d)&&!(c.clientY<f.offsetTop+b.offsetTop||c.clientY>f.offsetTop+b.offsetTop+f.offsetHeight-1||c.clientX<f.offsetLeft+b.offsetLeft||c.clientX>f.offsetLeft+b.offsetLeft+f.offsetWidth-1))return b.childNodes[e]}return null},launchon:function(b,c,d){return function(){var e=[];if(d)for(var f=0;f<d.length;f++)e.push(d[f]);if(arguments)for(f=0;f<arguments.length;f++)e.push(arguments[f]);
c.apply(b,e)}},getelementbyattribute:function(b,c,d){for(var e=0;e<b.childNodes.length;e++)if(b.childNodes[e].getAttribute&&b.childNodes[e].getAttribute(c)==d)return b.childNodes[e];return null},makediv:function(b,c){var d=document.createElement("div");d.style.position="absolute";void 0!==b.bgcolor&&(d.style.backgroundColor=b.bgcolor);void 0!==b.x&&(d.style.left=b.x);void 0!==b.y&&(d.style.top=b.y);void 0!==b.z&&(d.style.zIndex=b.z);void 0!==b.rx&&(d.style.right=b.rx);void 0!==b.ry&&(d.style.bottom=
b.ry);void 0!==b.w&&(d.style.width=b.w);void 0!==b.h&&(d.style.height=b.h);void 0!==b.classname&&(d.className=b.classname);void 0!==b.html&&(d.innerHTML=b.html);if(b.css)for(var e in b.css)d.style[e]=b.css[e];c&&c.appendChild(d);b.debug&&(d.style.border="1px dashed black",d.style.backgroundColor="#cecece",d.style.color="#000000");return d},applytouchevents:browse.applytouchevents,displaceobject:browse.displaceobject};
document.getPageElementById=function(b,c){return document.getElementById(b.getAttribute("widgetcontext")+"-"+c)};
